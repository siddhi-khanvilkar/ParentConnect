<!DOCTYPE html>
<html>
<head>
  <title>Attendance Table</title>
  <link rel="stylesheet" href="/path/to/attendencetable.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* Optional quick style for the message */
    #message {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Attendance for {{month}} {{year}}</h2>

  <form id="attendanceForm">
    <input type="hidden" name="month" value="{{month}}">
    <input type="hidden" name="year" value="{{year}}">
    <input type="hidden" id="working_days" name="working_days" value="{{working_days}}">

    <table border="1">
      <tr>
        <th>Student ID</th>
        <th>Name</th>
        <th>Roll No</th>
        <th>Class</th>
        <th>Present Days</th>
      </tr>
      {{#each students}}
      <tr>
        <td>{{this.student_id}}</td>
        <td>{{this.name}}</td>
        <td>{{this.rollno}}</td>
        <td>{{this.class}}</td>
        <td>
          <input
            type="number"
            name="attendance[{{this.student_id}}]"
            min="0"
            max="{{../working_days}}"
            required
            class="present-days"
          >
        </td>
      </tr>
      {{/each}}
    </table>

    <button type="submit">Save Attendance</button>
  </form>

  <div id="message"></div>

  <script>
    $(document).ready(function() {
      const maxWorkingDays = Number($('#working_days').val());

      // Enforce that present days do not exceed working days on input change
      $('.present-days').on('input', function() {
        let val = Number($(this).val());
        if (val > maxWorkingDays) {
          $(this).val(maxWorkingDays);
        } else if (val < 0) {
          $(this).val(0);
        }
      });

      // AJAX form submission to save attendance without page reload
      $('#attendanceForm').submit(function(e) {
        e.preventDefault();

        const formData = $(this).serialize();

        $.post('/auth/save', formData, function(response) {
          $('#message').css('color', 'green').text(response);
        }).fail(function(xhr) {
          let err = xhr.responseText || 'Error saving attendance.';
          $('#message').css('color', 'red').text(err);
        });
      });
    });
  </script>
</body>
</html>
